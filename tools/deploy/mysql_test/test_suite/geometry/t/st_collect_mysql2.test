#owner: yky448618
#owner group: shenzhen
--echo # ----------------------------------------------------------------------
--echo # Test of GEOMETRY ST_COLLECT aggregation function2.
--echo # ----------------------------------------------------------------------
--source mysql_test/test_suite/geometry/t/import_default_srs_data_mysql.inc

USE test;

--disable_warnings
DROP TABLE IF EXISTS product;
--enable_warnings

CREATE TABLE product (
year INTEGER,
product VARCHAR(256),
location Geometry
);

INSERT INTO product
(year,  product,     location) VALUES
(2000, "Calculator", ST_GeomFromText('point(60 -24)', 4326)),
(2000, "Computer"  , ST_GeomFromText('point(28 -77)', 4326)),
(2000, "Abacus"    , ST_GeomFromText('point(28 -77)', 4326)),
(2000, "TV"        , ST_GeomFromText('point(38  60)', 4326)),
(2001, "Calculator", ST_GeomFromText('point(60 -24)', 4326)),
(2001, "Computer"  , ST_GeomFromText('point(28 -77)', 4326));

--echo # test normal situation
SELECT ST_AsText(ST_Collect(location)) AS result FROM product;
--echo # test with distinct AND group_by
SELECT year, ST_AsText(ST_Collect(DISTINCT location)) AS result FROM product GROUP BY year;
--echo # result is null
SELECT ST_Collect(location) AS result FROM product WHERE year = 1999;
--echo # test with OVER_Claude
SELECT ST_AsText(ST_Collect(location)
    OVER (ORDER BY year, product ROWS BETWEEN 1 PRECEDING AND CURRENT ROW))
    AS result
FROM product;

DROP TABLE product;

--disable_warnings
DROP TABLE IF EXISTS simple_table;
--enable_warnings
CREATE TABLE simple_table ( running_number INTEGER NOT NULL AUTO_INCREMENT ,
geo GEOMETRY, PRIMARY KEY ( RUNNING_NUMBER));
INSERT INTO simple_table ( geo) VALUES
(ST_GEOMFROMTEXT('POINT(0 0)')),
(ST_GEOMFROMTEXT('LINESTRING(1 0, 1 1)')),
(ST_GEOMFROMTEXT('LINESTRING(2 0, 2 1)')),
(ST_GEOMFROMTEXT('POLYGON((3 0, 0 0, 0 3, 3 3, 3 0))')),
(ST_GEOMFROMTEXT('POLYGON((4 0, 0 0, 0 4, 4 4, 4 0))')),
(ST_GEOMFROMTEXT('MULTIPOINT(5 0)')),
(ST_GEOMFROMTEXT('MULTIPOINT(6 0)')),
(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION EMPTY')),
(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION EMPTY'));

SELECT ST_ASTEXT(ST_COLLECT(geo)) FROM simple_table GROUP BY geo WITH ROLLUP;

SELECT ST_ASTEXT(ST_COLLECT(geo)) FROM simple_table;

SELECT CAST(ST_COLLECT(geo) AS DECIMAL ) FROM simple_table;

DROP TABLE simple_table;