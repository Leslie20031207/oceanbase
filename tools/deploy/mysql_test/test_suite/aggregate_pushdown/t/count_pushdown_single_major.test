# owner: yht146439
#tags: optimizer
# description: pushdown aggregation(count) to storage layer

--disable_query_log
set global max_allowed_packet=60000000;
set global ob_sql_work_area_percentage=80;
sleep 1;
connect (obsys,$OBMYSQL_MS0,admin,$OBMYSQL_PWD,test,$OBMYSQL_PORT);
connection default;
set @@recyclebin = off;
set ob_query_timeout=1000000000;
set ob_trx_timeout=1000000000;

--disable_warnings
drop table if exists t1;
--enable_warnings
--enable_query_log

# count(*),count(column),count(1),count(null)
create table t1 (id int, libname varchar(21), city varchar(256), primary key (id)) row_format = REDUNDANT compression = 'none';

--let $loop=0
while($loop < 5000)
{
  eval insert into t1 value ($loop, 'test', repeat ('a', 256));
  inc $loop;
}

## minor freeze
alter system minor freeze;
--source mysql_test/include/wait_minor_merge.inc

alter system major freeze;
--source mysql_test/include/wait_daily_merge.inc

select count(1) from t1;

select count(id) from t1;

select count(1) from t1 where id > 3000;

drop table t1;
