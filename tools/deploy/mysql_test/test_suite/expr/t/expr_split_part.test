--disable_query_log
set @@session.explicit_defaults_for_timestamp=off;
--enable_query_log
# owner: jim.wzh
# owner group: SQL

# correctness case
SELECT SPLIT_PART('a,b,c,d', ',', 1); 
SELECT SPLIT_PART('a,b,c,d', ',', 2); 
SELECT SPLIT_PART('a,b,c,d', ',', 4);
SELECT SPLIT_PART('apple#banana#cherry', '#', 2);
SELECT SPLIT_PART('apple@banana@cherry', '@', 3);
SELECT SPLIT_PART('a--b--c--d', '--', 3);
SELECT SPLIT_PART('a,b,c,d', '#', 1);

# side case
SELECT SPLIT_PART('x,y,z', ',', 5);
SELECT SPLIT_PART('abc', '', 2);
SELECT SPLIT_PART('abc', '', 4);
SELECT SPLIT_PART(',a,b,c,', ',', 1);
SELECT SPLIT_PART(',a,b,c,', ',', 5);
SELECT SPLIT_PART('', ',', 1);
SELECT SPLIT_PART('a,b,c', ',', 0); 
SELECT SPLIT_PART('a,b,c', ',', -1);

# special case
SELECT SPLIT_PART('a,,b,,c', ',', 2);
SELECT SPLIT_PART('a,,b,,c', ',', 3);
SELECT SPLIT_PART('a,,b', ',', 2);
SELECT SPLIT_PART('a,,b,,c,,', ',', 6);

# other case
SELECT SPLIT_PART(2134, 1, 2);
SELECT SPLIT_PART(2134, '1', 2);
SELECT SPLIT_PART(1.2345, '.', 1);
SELECT SPLIT_PART('a,,b,,c', null, 2);
SELECT SPLIT_PART(null, ',', 2);
SELECT SPLIT_PART('a,,b,,c', ',', null);

# collation & collation collation_level
--disable_warnings
drop table if exists charset_test;
--enable_warnings
CREATE TABLE charset_test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    utf8_col VARCHAR(255) CHARACTER SET utf8,
    gbk_col VARCHAR(255) CHARACTER SET gbk,
    binary_col VARCHAR(255) CHARACTER SET binary
);

INSERT INTO charset_test (utf8_col, gbk_col, binary_col)
VALUES ('abcabc', 'abcabc', 'abcabc'),
       ('你好', '你好', '你好'),
       ('nihao你好你好', 'nihao你好你好', 'nihao你好你好'),
       ('好好', '好好', '好好');
        
SELECT SPLIT_PART(utf8_col, 'a', 2) FROM charset_test;
SELECT SPLIT_PART(gbk_col, 'a', 2) FROM charset_test;
SELECT SPLIT_PART(binary_col, 'a', 2) FROM charset_test;
SELECT COLLATION(SPLIT_PART(utf8_col, 'a', 2)) FROM charset_test;
SELECT COLLATION(SPLIT_PART(gbk_col, 'a', 2)) FROM charset_test;
SELECT COLLATION(SPLIT_PART(binary_col, 'a', 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(utf8_col, 'a', 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(gbk_col, 'a', 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(binary_col, 'a', 2)) FROM charset_test;

SELECT SPLIT_PART(utf8_col, '好', 1) FROM charset_test;
SELECT SPLIT_PART(gbk_col, '好', 1) FROM charset_test;
SELECT SPLIT_PART(binary_col, '好', 1) FROM charset_test;
SELECT COLLATION(SPLIT_PART(utf8_col, '好', 1)) FROM charset_test;
SELECT COLLATION(SPLIT_PART(gbk_col, '好', 1)) FROM charset_test;
SELECT COLLATION(SPLIT_PART(binary_col, '好', 1)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(utf8_col, '好', 1)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(gbk_col, '好', 1)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(binary_col, '好', 1)) FROM charset_test;

SELECT COLLATION(SPLIT_PART('abcabcabca', utf8_col, 2)) FROM charset_test;
SELECT COLLATION(SPLIT_PART('abcabcabca', gbk_col, 2)) FROM charset_test;
SELECT COLLATION(SPLIT_PART('abcabcabca', binary_col, 2)) FROM charset_test;


SELECT COERCIBILITY(SPLIT_PART('abcabcabca', utf8_col, 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART('abcabcabca', gbk_col, 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART('abcabcabca', binary_col, 2)) FROM charset_test;

SELECT COLLATION(SPLIT_PART(_utf8mb4'abcabcabcs' COLLATE utf8mb4_bin, 'gbk_col', 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART(_utf8mb4'abcabcabcs' COLLATE utf8mb4_bin, 'gbk_col', 2)) FROM charset_test;
SELECT COLLATION(SPLIT_PART( gbk_col,_utf8mb4'abcabcabcs' COLLATE utf8mb4_bin, 2)) FROM charset_test;
SELECT COERCIBILITY(SPLIT_PART( gbk_col,_utf8mb4'abcabcabcs' COLLATE utf8mb4_bin, 2)) FROM charset_test;