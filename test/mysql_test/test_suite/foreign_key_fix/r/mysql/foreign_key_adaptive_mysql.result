#-----------------------------------------------------------------------
# Test case to verify create fk
#-----------------------------------------------------------------------
create table t1(c1 int, c2 int, c3 int, primary key(c1,c2,c3));
create table t2(c1 int, c2 int, c3 int, foreign key(c1) references t1(c1));
create table t3(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c1,c2));
create table t4(c1 int, c2 int, c3 int, foreign key(c1,c2,c3) references t1(c1,c2,c3));
create table t5(c1 int, c2 int, c3 int, foreign key(c1) references t1(c2));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1) references t1(c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c1,c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c2,c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c2,c1));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int);
alter table t5 add constraint fk foreign key(c1) references t1(c1);
alter table t5 drop foreign key fk;
alter table t5 add constraint fk foreign key(c1,c2) references t1(c1,c2);
alter table t5 drop foreign key fk;
alter table t5 add constraint fk foreign key(c1,c2,c3) references t1(c1,c2,c3);
alter table t5 drop foreign key fk;
alter table t5 add constraint foreign key(c1) references t1(c2);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1) references t1(c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c1,c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c2,c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c2,c1);
ERROR HY000: Cannot add foreign key constraint
drop table t2;
drop table t3;
drop table t4;
drop table t5;
drop table t1;
create table t1(c1 int, c2 int, c3 int, unique key(c1,c2,c3));
create table t2(c1 int, c2 int, c3 int, foreign key(c1) references t1(c1));
create table t3(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c1,c2));
create table t4(c1 int, c2 int, c3 int, foreign key(c1,c2,c3) references t1(c1,c2,c3));
create table t5(c1 int, c2 int, c3 int, foreign key(c1) references t1(c2));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1) references t1(c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c1,c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c2,c3));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int, foreign key(c1,c2) references t1(c2,c1));
ERROR HY000: Cannot add foreign key constraint
create table t5(c1 int, c2 int, c3 int);
alter table t5 add constraint fk foreign key(c1) references t1(c1);
alter table t5 drop foreign key fk;
alter table t5 add constraint fk foreign key(c1,c2) references t1(c1,c2);
alter table t5 drop foreign key fk;
alter table t5 add constraint fk foreign key(c1,c2,c3) references t1(c1,c2,c3);
alter table t5 drop foreign key fk;
alter table t5 add constraint foreign key(c1) references t1(c2);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1) references t1(c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c1,c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c2,c3);
ERROR HY000: Cannot add foreign key constraint
alter table t5 add constraint foreign key(c1,c2) references t1(c2,c1);
ERROR HY000: Cannot add foreign key constraint
drop table t2;
drop table t3;
drop table t4;
drop table t5;
drop table t1;
#-----------------------------------------------------------------------
# Test case to verify use fk
#-----------------------------------------------------------------------
create table t1(c1 int, c2 int, primary key(c1,c2));
create table t2(c1 int, c2 int, foreign key(c1) references t1(c1) on delete cascade on update cascade);
insert into t1 values(1,1),(1,2),(2,1),(2,2),(3,3);
insert into t2 values(1,1),(1,3),(2,0),(3,1);
insert into t2 values(4,1);
ERROR 23000: Cannot add or update a child row: a foreign key constraint fails
select * from t2;
c1	c2
1	1
1	3
2	0
3	1
update t1 set c1=4 where c1=2;
select * from t2;
c1	c2
1	1
1	3
4	0
3	1
update t1 set c2=5 where c1=4 and c2=1;
select * from t2;
c1	c2
1	1
1	3
4	0
3	1
delete from t1 where c1=1 and c2=1;
select * from t2;
c1	c2
4	0
3	1
drop table t2;
drop table t1;
